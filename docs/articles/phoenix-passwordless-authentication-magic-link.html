<!DOCTYPE html><head><style>/* Webfont: LatoLatin-Black */@font-face {
    font-family: 'LatoLatinWebBlack';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Black.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Black.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Black.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Black.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Black.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-BlackItalic */@font-face {
    font-family: 'LatoLatinWebBlack';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-BlackItalic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-BlackItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-BlackItalic.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-BlackItalic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-BlackItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Bold */@font-face {
    font-family: 'LatoLatinWeb';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Bold.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Bold.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Bold.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Bold.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Bold.ttf') format('truetype');
    font-style: normal;
    font-weight: bold;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-BoldItalic */@font-face {
    font-family: 'LatoLatinWeb';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-BoldItalic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-BoldItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-BoldItalic.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-BoldItalic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-BoldItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: bold;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Hairline */@font-face {
    font-family: 'LatoLatinWebHairline';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Hairline.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Hairline.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Hairline.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Hairline.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Hairline.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-HairlineItalic */@font-face {
    font-family: 'LatoLatinWebHairline';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-HairlineItalic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-HairlineItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-HairlineItalic.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-HairlineItalic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-HairlineItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Heavy */@font-face {
    font-family: 'LatoLatinWebHeavy';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Heavy.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Heavy.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Heavy.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Heavy.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Heavy.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-HeavyItalic */@font-face {
    font-family: 'LatoLatinWebHeavy';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-HeavyItalic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-HeavyItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-HeavyItalic.woff2') format('woff2'), /* Modern Browsers */
         url('vfonts/LatoLatin-HeavyItalic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-HeavyItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Italic */@font-face {
    font-family: 'LatoLatinWeb';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Italic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Italic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Italic.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Italic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Italic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Light */@font-face {
    font-family: 'LatoLatinWebLight';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Light.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Light.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Light.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Light.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Light.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-LightItalic */@font-face {
    font-family: 'LatoLatinWebLight';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-LightItalic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-LightItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-LightItalic.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-LightItalic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-LightItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Medium */@font-face {
    font-family: 'LatoLatinWebMedium';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Medium.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Medium.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Medium.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Medium.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Medium.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-MediumItalic */@font-face {
    font-family: 'LatoLatinWebMedium';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-MediumItalic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-MediumItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-MediumItalic.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-MediumItalic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-MediumItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Regular */@font-face {
    font-family: 'LatoLatinWeb';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Regular.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Regular.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Regular.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Regular.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Semibold */@font-face {
    font-family: 'LatoLatinWebSemibold';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Semibold.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Semibold.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Semibold.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Semibold.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Semibold.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-SemiboldItalic */@font-face {
    font-family: 'LatoLatinWebSemibold';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-SemiboldItalic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-SemiboldItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-SemiboldItalic.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-SemiboldItalic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-SemiboldItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Thin */@font-face {
    font-family: 'LatoLatinWebThin';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Thin.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-Thin.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Thin.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Thin.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-Thin.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-ThinItalic */@font-face {
    font-family: 'LatoLatinWebThin';
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-ThinItalic.eot'); /* IE9 Compat Modes */
    src: url('src/fonts/LatoLatin/fonts/LatoLatin-ThinItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('src/fonts/LatoLatin/fonts/LatoLatin-ThinItalic.woff2') format('woff2'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-ThinItalic.woff') format('woff'), /* Modern Browsers */
         url('src/fonts/LatoLatin/fonts/LatoLatin-ThinItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

body {
	font-family: "LatoLatinWeb";
	font-size: 9pt;
	font-style: normal;
	margin: 0 0 0 0;
	padding: 0 0 0 0;
}

#menu {
	position: fixed;
	top: 0.50em;
    left: 0;
	
}
#nav {
	font-family: "LatoLatinWeb";
	background-color: none;
	width:150px;
	text-align:left;
	font-size:1em;
	list-style: none;
	margin: 0 0 0 0;
	padding: 0 20 30 20;
	float:left;
}

#nav li {
	float:none;
}

#nav li a:link {
	display:block;
	padding: 4px 5px;
	text-decoration: none;
	background-color: #eee;
	color:#222;
	
}

.large {
	font-size: 2.2em;
}
#main {
	font-family: "LatoLatinWeb";
	font-style: normal;
	font-size: 1.5em;
	color: black;
	background-color: white;
	width: 840px;
	padding: 0 40px 0 40px;
	margin-left: 180px;
	margin-top: auto;
	margin-right: 0;
}
.waterfall {
	font-size: 10px;
	width:100%;
	overflow: hidden;
	text-shadow: 0px 0px 0px black;
	color: #000;
}

.size10{ font-size: 10px; }
.size11{ font-size: 11px; }
.size12{ font-size: 12px; }
.size13{ font-size: 13px; }
.size14{ font-size: 14px; }
.size16{ font-size: 16px; }
.size18{ font-size: 18px; }
.size20{ font-size: 20px; }
.size24{ font-size: 24px; }
.size30{ font-size: 30px; }
.size36{ font-size: 36px; }
.size48{ font-size: 48px; }
.size60{ font-size: 60px; }
.size72{ font-size: 72px; }
.size90{ font-size: 90px; }body {
  background-color: #3d3f41;
  font-family: "Lato", sans-serif;
  color: #c7c7b0;
}
.mainpage {
  display: block;
}
h1 {
  display: block;
  font-size: 4.5rem;
  margin-block-start: 0.67em;
  margin-block-end: 0.67em;
  margin-inline-start: 0px;
  margin-inline-end: 0px;
  font-weight: bold;
}
.links {
  position: fixed;
  list-style: none;
  width: 120px;
  bottom: 40px;
  right: 20px;
  padding: 0;
  margin: 0;
  z-index: 998;
}
.links p {
  font-family: "Lato", sans-serif;
  text-transform: uppercase;
  text-align: center;
  padding: 0.25em 0;
  letter-spacing: 2px;
  font-size: 10px;
  display: block;
  width: 100%;
  opacity: 0.6;
  color: #FFF;
}
.links li {
  border-bottom: #222 1px solid;
  border-bottom: rgba(255, 255, 255, 0.1) 1px solid;
}
.links li a {
  transition: opacity 0.2s ease-out;
  font-family: "Lato", sans-serif;
  text-transform: uppercase;
  text-align: right;
  padding: 0.25em 0;
  letter-spacing: 2px;
  font-size: 12px;
  display: block;
  width: 100%;
  opacity: 0.4;
  color: #FFF;
}
.links li a:hover {
  opacity: 0.8;
}
.links li .who:before {
  opacity: 0.5;
  content: '@';
  float: left;
}
.links li .source:before {
  opacity: 0.5;
  content: '{}';
  float: left;
}
.links li .blog:before {
  opacity: 0.5;
  content: '&';
  float: left;
}
.hide {
  opacity: 0;
}
*,
*::before,
*::after {
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
:root {
  font-size: 10px;
  --padding: 3rem;
}
::-moz-selection {
  background: #111111;
  color: #595959;
}
::selection {
  background: #111111;
  color: #595959;
}
html {
  font-family: "Lato", sans-serif;
}
@supports (font-variation-settings: normal) {
  html {
    font-family: "Lato", sans-serif;
  }
}
h1,
h2,
h3,
h4,
p,
a,
span {
  text-rendering: geometricPrecision;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
h1 {
  font-size: 3.5rem;
  line-height: 1.3;
}
a {
  text-decoration: none;
  color: white;
  -webkit-filter: brightness(0.8);
  filter: brightness(0.8);
  -webkit-transition: 150ms;
  -o-transition: 150ms;
  transition: 150ms;
}
a,
a * {
  border-radius: 0.15rem;
}
a:hover {
  -webkit-filter: brightness(1.09);
  filter: brightness(1.09);
}
menu {
  justify-content: space-between;
  position: fixed;
  width: 100%;
  top: 0;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.262);
  z-index: 999;
}
menu a {
  font-size: 2.2rem;
  color: white;
  text-align: center;
  display: block;
  float: left;
  padding: 16px 14px;
  text-decoration: none;
}
.grid {
  display: -ms-grid;
  display: grid;
  -ms-grid-columns: 1fr 1.5rem 1fr 1.5rem 1fr 1.5rem 1fr 1.5rem 1fr 1.5rem 1fr;
  grid-template-columns: repeat(6, 1fr);
  grid-row-gap: 1.5rem;
  grid-column-gap: 1.5rem;
  margin: 0 auto;
  max-width: 150rem;
}
body {
  background: #1a1a1a;
  color: white;
}
.gridblog {
  grid-template-columns: repeat(6, 1fr);
  grid-row-gap: 1.5rem;
  grid-column-gap: 1.5rem;
  margin: 0 auto;
  max-width: 150rem;
  min-height: 100vh;
}
.full {
  grid-column-start: 1;
  -ms-grid-column-span: 7;
  grid-column-end: span 7;
}
.intro {
  grid-column-start: 1;
  grid-column-end: span 5;
  margin-top: 6rem;
  font-size: 4.5rem;
}
.project-grid {
  grid-column-start: 1;
  grid-column-end: span 7;
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  grid-row-gap: 15rem;
  grid-column-gap: 2rem;
  margin: 1rem auto;
}
.project-grid a {
  -ms-grid-column-span: 2;
  grid-column: span 2;
  color: white;
  min-height: 56.25%;
}
.project-grid a h3 {
  font-size: 2.15rem;
  margin: 1.25rem 0;
}
.project-grid a p {
  font-size: 1.5rem;
  color: lightgrey;
}
.project-grid a img {
  margin-bottom: 0;
  -o-object-fit: cover;
  object-fit: cover;
  width: 100%;
  height: 100%;
}
main {
  padding: 3rem var(--padding);
}
footer {
  margin-top: 8rem;
  padding: 6rem var(--padding);
  display: flex;
  -webkit-box-pack: justify;
  justify-content: space-between;
  -webkit-box-align: center;
  align-items: center;
  flex-wrap: wrap;
  margin: 0 auto;
  max-width: 150rem;
  
}
footer > * {
  margin-top: var(--padding);
}
footer h2 {
  font-size: 4.5rem;
}
.button {
  padding: 2rem 3rem;
  font-size: 2.5rem;
  background: #8e8e8e;
  color: #1a1a1a;
}
.button:hover {
  -webkit-filter: brightness(1.5);
  filter: brightness(1.5);
}
.blog-grid {
  grid-column-start: 1;
  display: grid;
  grid-template-rows: repeat(3, fr);
  grid-row-gap: 15rem;
  grid-column-gap: 2rem;
  margin: 1rem auto;
  justify-content: left;
}
.articles {
  list-style: none;
}
.articles__item {
  display: flex;
  flex-wrap: wrap;
}
.articles__item__link {
  flex: 1;
  text-decoration: none;
  cursor: auto;
}
.articles__item__title {
  font-size: 2.15rem;
  margin: 1.25rem 0;
}
.articles__item__date {
  margin-right: 0.75rem;
  flex-basis: 7em;
}
@media (max-width: 960px) {
  :root {
    font-size: 9px;
  }
  .intro {
    grid-column-start: 1;
    -ms-grid-column-span: 7;
    grid-column-end: span 7;
  }
  .project-grid {
    grid-row-gap: 16rem;
  }
  .project-grid a h3 {
    font-size: 2.5rem;
    margin-bottom: 1.15rem;
  }
  .project-grid a {
    -ms-grid-column-span: 3;
    grid-column: span 3;
  }
}

.task {
  cursor:move;
  background-color:var(--white);
  padding:1rem;
  border-radius:8px;
  width:100%;
  box-shadow: rgba(99, 99, 99, 0.1) 0px 2px 8px 0px;
  margin-bottom:1rem;
  border:3px dashed transparent;
} 
.task__tag--copyright:hover {
  box-shadow: rgba(99, 99, 99, 0.3) 0px 2px 8px 0px;
  border-color:rgba(162,179,207,.2)!important;
}
   
.task__tag {
  border-radius:100px;
  padding:2px 13px;
  font-size:12px;
  cursor:pointer;
}

.task__tag--copyright {
  color:white;
  background-color:orange;
  font-weight: 900;
}
 
.atitle {
  padding-top: 4rem;
}

.acontent {
  padding-top: 2rem;
}



@media (max-width: 700px) {
  :root {
    font-size: 8px;
    --padding: 2rem;
  }
  .project-grid {
    grid-row-gap: 24rem;
  }
  .project-grid a {
    -ms-grid-column-span: 6;
    grid-column: span 6;
  }
  .project-grid a h3 {
    font-size: 3rem;
    margin-top: 2rem;
  }
  .project-grid a p {
    font-size: 1.75rem;
  }
  .project-grid a img {
    width: 100vw;
    margin: auto calc(50% - 50vw);
  }
}
@media (min-width: 4000px) {
  :root {
    font-size: 40px;
  }
}
</style><meta charset="utf-8"><title>Blog</title></head><body><ul class="links" id="links"> <li><a class="who" href="https://discord.com/invite/2Uj6N5N" target="_blank">Discord</a></li><li><a class="blog" href="https://www.youtube.com/c/ViktorBřenekYT" target="_blank">Youtube</a></li><li><a class="source" href="https://github.com/viktorbrenek" target="_blank">Github</a></li></ul><menu><a class="name" href="#">Viktor Břenek</a><a class="name" href="https://viktorbrenek.github.io/blog">Blog</a><a class="name" href="https://viktorbrenek.github.io">Portfolio</a></menu><main class="gridblog"><h1 class="atitle">Passwordless Authentication in Phoenix</h1><div class="task__tags"><span class="task__tag task__tag--copyright"> <a>Phoenix,Authentication,Passwordless,Magic Links,Magic Link,Magic Login,Token Authentication,Tutorial,How To</a></span></div><p class="acontent">&lt;p&gt;There are tons of &lt;a href=&quot;https://www.smashingmagazine.com/2016/06/the-current-state-of-authentication-we-have-a-password-problem/&quot;&gt;different approaches to user authentication&lt;/a&gt;.
Passwordless or &lt;em&gt;“magic link”&lt;/em&gt; authentication is &lt;a href=&quot;https://www.sitepoint.com/passwordless-authentication-works/&quot;&gt;very user friendly&lt;/a&gt;,
relatively easy to implement and sufficiently secure for most apps.
This article is a step by step guide for implementing passwordless authentication in Phoenix.&lt;/p&gt;
&lt;div id=&quot;more&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;note&quot;&gt;
  &lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt;
  This guide assumes you are familiar with
  &lt;a href=&quot;https://medium.com/aws-activate-startup-blog/increase-engagement-and-enhance-security-with-passwordless-authentication-212d75d4f7cc#.2gxpaxsuv&quot;&gt;the basic flow&lt;/a&gt;,
  which you might have experienced in Slack or a growing number of apps:
  You provide an email address and get a &lt;em&gt;magic link email&lt;/em&gt; containing a one time authentication token.
  The token is valid for a short period of time, clicking the link redeems it and signs you in – no more passwords!&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;The basic user model&lt;/h2&gt;
&lt;p&gt;This guide assumes you already have a &lt;code&gt;User&lt;/code&gt; model in place.
If that is not the case: Don’t worry and quickly generate it.
For our purpose we just need an &lt;code&gt;email&lt;/code&gt; property, extend it however you feel like …&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;mix phoenix.gen.html User users email:string
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;The authentication token model&lt;/h2&gt;
&lt;p&gt;Even though the &lt;code&gt;AuthToken&lt;/code&gt; is the main subject of this article it is pretty simple:
All it needs is the token value, a timestamp of its creation and the relationship to a user.
As there will be no user interface for anything token related, we can use the model generator to create it.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;mix phoenix.gen.model AuthToken auth_tokens value:string user_id:references:users
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We need to adjust the migration a little bit, because&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the &lt;code&gt;updated_at&lt;/code&gt; timestamp is unnecessary&lt;/li&gt;
&lt;li&gt;the &lt;code&gt;value&lt;/code&gt; should have an unique index&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;change&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
  create table(&lt;span class=&quot;hljs-symbol&quot;&gt;:auth_tokens&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    add &lt;span class=&quot;hljs-symbol&quot;&gt;:value&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;:string&lt;/span&gt;
    add &lt;span class=&quot;hljs-symbol&quot;&gt;:user_id&lt;/span&gt;, references(&lt;span class=&quot;hljs-symbol&quot;&gt;:users&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;on_delete:&lt;/span&gt; &lt;span class=&quot;hljs-symbol&quot;&gt;:delete_all&lt;/span&gt;)

    timestamps(&lt;span class=&quot;hljs-symbol&quot;&gt;updated_at:&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;)
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  create index(&lt;span class=&quot;hljs-symbol&quot;&gt;:auth_tokens&lt;/span&gt;, [&lt;span class=&quot;hljs-symbol&quot;&gt;:user_id&lt;/span&gt;])
  create unique_index(&lt;span class=&quot;hljs-symbol&quot;&gt;:auth_tokens&lt;/span&gt;, [&lt;span class=&quot;hljs-symbol&quot;&gt;:value&lt;/span&gt;])
&lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We also need to reflect these changes in the &lt;code&gt;AuthToken&lt;/code&gt; model.&lt;br&gt;
While we are at it, let’s also adapt the &lt;code&gt;changeset&lt;/code&gt; function to&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;receive the user&lt;/li&gt;
&lt;li&gt;not cast any params&lt;/li&gt;
&lt;li&gt;generate the token value&lt;/li&gt;
&lt;li&gt;ensure uniqueness of the generated value&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyApp.AuthToken&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;hljs-keyword&quot;&gt;use&lt;/span&gt; MyApp.Web, &lt;span class=&quot;hljs-symbol&quot;&gt;:model&lt;/span&gt;

  &lt;span class=&quot;hljs-keyword&quot;&gt;alias&lt;/span&gt; MyApp.{Endpoint, User}
  &lt;span class=&quot;hljs-keyword&quot;&gt;alias&lt;/span&gt; Phoenix.Token

  schema &lt;span class=&quot;hljs-string&quot;&gt;&quot;auth_tokens&quot;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    field &lt;span class=&quot;hljs-symbol&quot;&gt;:value&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;:string&lt;/span&gt;
    belongs_to &lt;span class=&quot;hljs-symbol&quot;&gt;:user&lt;/span&gt;, User

    timestamps(&lt;span class=&quot;hljs-symbol&quot;&gt;updated_at:&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;false&lt;/span&gt;)
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;changeset&lt;/span&gt;&lt;/span&gt;(struct, user) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    struct
    |&amp;gt; cast(%{}, []) &lt;span class=&quot;hljs-comment&quot;&gt;# convert the struct without taking any params&lt;/span&gt;
    |&amp;gt; put_assoc(&lt;span class=&quot;hljs-symbol&quot;&gt;:user&lt;/span&gt;, user)
    |&amp;gt; put_change(&lt;span class=&quot;hljs-symbol&quot;&gt;:value&lt;/span&gt;, generate_token(user))
    |&amp;gt; validate_required([&lt;span class=&quot;hljs-symbol&quot;&gt;:value&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;:user&lt;/span&gt;])
    |&amp;gt; unique_constraint(&lt;span class=&quot;hljs-symbol&quot;&gt;:value&lt;/span&gt;)
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-comment&quot;&gt;# generate a random and url-encoded token of given length&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defp&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;generate_token&lt;/span&gt;&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;nil&lt;/span&gt;), &lt;span class=&quot;hljs-symbol&quot;&gt;do:&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;nil&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defp&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;generate_token&lt;/span&gt;&lt;/span&gt;(user) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    Token.sign(Endpoint, &lt;span class=&quot;hljs-string&quot;&gt;&quot;user&quot;&lt;/span&gt;, user.id)
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This uses &lt;code&gt;Phoenix.Token&lt;/code&gt; to generate a signed 96 character long string everytime a token is created.
This string is the token value and will be part of the magic link the user receives to sign in.&lt;/p&gt;
&lt;p&gt;Having prepared the &lt;code&gt;AuthToken&lt;/code&gt; model we also need to wire up the other side of the association.
Let’s add the &lt;code&gt;has_many&lt;/code&gt; relation to our &lt;code&gt;User&lt;/code&gt; schema:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;schema &lt;span class=&quot;hljs-string&quot;&gt;&quot;users&quot;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;hljs-comment&quot;&gt;# add the association among the rest of the schema&lt;/span&gt;
  has_many &lt;span class=&quot;hljs-symbol&quot;&gt;:auth_tokens&lt;/span&gt;, AuthToken
&lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This concludes the model part, let’s have a look at the controller.&lt;/p&gt;
&lt;h2&gt;Session handling&lt;/h2&gt;
&lt;p&gt;Our &lt;code&gt;SessionController&lt;/code&gt; needs four actions to cover the flow:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;new&lt;/code&gt; presents the login form asking the user for the email address.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;create&lt;/code&gt; looks up the user by the email, creates the token and sends it.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;show&lt;/code&gt; is the action to redeem the token and eventually sign in the user.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delete&lt;/code&gt; offers the standard logout and drops the current session.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Generate the controller using the HTML-generator and providing the &lt;code&gt;--no-model&lt;/code&gt; flag:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;mix phoenix.gen.html Session sessions email:string --no-model
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Add these route definitions for the required actions:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;get &lt;span class=&quot;hljs-string&quot;&gt;&quot;/signin/:token&quot;&lt;/span&gt;, SessionController, &lt;span class=&quot;hljs-symbol&quot;&gt;:show&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;as:&lt;/span&gt; &lt;span class=&quot;hljs-symbol&quot;&gt;:signin&lt;/span&gt;
resources &lt;span class=&quot;hljs-string&quot;&gt;&quot;/sessions&quot;&lt;/span&gt;, SessionController, &lt;span class=&quot;hljs-symbol&quot;&gt;only:&lt;/span&gt; [&lt;span class=&quot;hljs-symbol&quot;&gt;:new&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;:create&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;:delete&lt;/span&gt;]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The controller uses a separate &lt;code&gt;TokenAuthentication&lt;/code&gt; service which we will cover in detail afterwards.
Let’s first take a closer look at the implementation of the actions described above:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyApp.SessionController&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;hljs-variable&quot;&gt;@moduledoc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Actions for creating and signing in with magic link tokens.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-keyword&quot;&gt;use&lt;/span&gt; MyApp.Web, &lt;span class=&quot;hljs-symbol&quot;&gt;:controller&lt;/span&gt;

  &lt;span class=&quot;hljs-keyword&quot;&gt;alias&lt;/span&gt; MyApp.TokenAuthentication

  &lt;span class=&quot;hljs-variable&quot;&gt;@doc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Login page with email form.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;new&lt;/span&gt;&lt;/span&gt;(conn, _params) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    render(conn, &lt;span class=&quot;hljs-string&quot;&gt;&quot;new.html&quot;&lt;/span&gt;)
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-variable&quot;&gt;@doc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Generates and sends magic login token if the user can be found.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;create&lt;/span&gt;&lt;/span&gt;(conn, %{&lt;span class=&quot;hljs-string&quot;&gt;&quot;session&quot;&lt;/span&gt; =&amp;gt; %{&lt;span class=&quot;hljs-string&quot;&gt;&quot;email&quot;&lt;/span&gt; =&amp;gt; email}}) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    TokenAuthentication.provide_token(email)

    &lt;span class=&quot;hljs-comment&quot;&gt;# do not leak information about (non-)existing users.&lt;/span&gt;
    &lt;span class=&quot;hljs-comment&quot;&gt;# always reply with success message, even though the&lt;/span&gt;
    &lt;span class=&quot;hljs-comment&quot;&gt;# user might not exist.&lt;/span&gt;
    conn
    |&amp;gt; put_flash(&lt;span class=&quot;hljs-symbol&quot;&gt;:info&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;We have sent you a link for signing in via email to &lt;span class=&quot;hljs-subst&quot;&gt;#{email}&lt;/span&gt;.&quot;&lt;/span&gt;)
    |&amp;gt; redirect(&lt;span class=&quot;hljs-symbol&quot;&gt;to:&lt;/span&gt; page_path(conn, &lt;span class=&quot;hljs-symbol&quot;&gt;:index&lt;/span&gt;))
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-variable&quot;&gt;@doc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Login user via magic link token.
    Sets the given user as `current_user` and updates the session.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;show&lt;/span&gt;&lt;/span&gt;(conn, %{&lt;span class=&quot;hljs-string&quot;&gt;&quot;token&quot;&lt;/span&gt; =&amp;gt; token}) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; TokenAuthentication.verify_token_value(token) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
      {&lt;span class=&quot;hljs-symbol&quot;&gt;:ok&lt;/span&gt;, user} -&amp;gt;
        conn
        |&amp;gt; assign(&lt;span class=&quot;hljs-symbol&quot;&gt;:current_user&lt;/span&gt;, user)
        |&amp;gt; put_session(&lt;span class=&quot;hljs-symbol&quot;&gt;:user_id&lt;/span&gt;, user.id)
        |&amp;gt; configure_session(&lt;span class=&quot;hljs-symbol&quot;&gt;renew:&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;)
        |&amp;gt; put_flash(&lt;span class=&quot;hljs-symbol&quot;&gt;:info&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;You signed in successfully.&quot;&lt;/span&gt;)
        |&amp;gt; redirect(&lt;span class=&quot;hljs-symbol&quot;&gt;to:&lt;/span&gt; page_path(conn, &lt;span class=&quot;hljs-symbol&quot;&gt;:index&lt;/span&gt;))

      {&lt;span class=&quot;hljs-symbol&quot;&gt;:error&lt;/span&gt;, _reason} -&amp;gt;
        conn
        |&amp;gt; put_flash(&lt;span class=&quot;hljs-symbol&quot;&gt;:error&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;The login token is invalid.&quot;&lt;/span&gt;)
        |&amp;gt; redirect(&lt;span class=&quot;hljs-symbol&quot;&gt;to:&lt;/span&gt; session_path(conn, &lt;span class=&quot;hljs-symbol&quot;&gt;:new&lt;/span&gt;))
    &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-variable&quot;&gt;@doc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Ends the current session.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;delete&lt;/span&gt;&lt;/span&gt;(conn, _params) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    conn
    |&amp;gt; assign(&lt;span class=&quot;hljs-symbol&quot;&gt;:current_user&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;nil&lt;/span&gt;)
    |&amp;gt; configure_session(&lt;span class=&quot;hljs-symbol&quot;&gt;drop:&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;true&lt;/span&gt;)
    |&amp;gt; delete_session(&lt;span class=&quot;hljs-symbol&quot;&gt;:user_id&lt;/span&gt;)
    |&amp;gt; put_flash(&lt;span class=&quot;hljs-symbol&quot;&gt;:info&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;You logged out successfully. Enjoy your day!&quot;&lt;/span&gt;)
    |&amp;gt; redirect(&lt;span class=&quot;hljs-symbol&quot;&gt;to:&lt;/span&gt; page_path(conn, &lt;span class=&quot;hljs-symbol&quot;&gt;:index&lt;/span&gt;))
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;new&lt;/code&gt; is the only action that needs a template, but there is a little gotcha here:
As we do not have a session model we cannot use the standard way of passing a changeset to the email form.
Instead we have to setup the &lt;code&gt;form_for&lt;/code&gt; ourselves.
This is what it looks like:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-erb&quot;&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;h2&lt;/span&gt;&amp;gt;&lt;/span&gt;Sign In&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;h2&lt;/span&gt;&amp;gt;&lt;/span&gt;

&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;%=&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; form_for @conn, session_path(@conn, &lt;span class=&quot;hljs-symbol&quot;&gt;:create&lt;/span&gt;), [&lt;span class=&quot;hljs-symbol&quot;&gt;as:&lt;/span&gt; &lt;span class=&quot;hljs-symbol&quot;&gt;:session&lt;/span&gt;], fn f -&amp;gt; &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;hljs-attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;hljs-string&quot;&gt;&quot;form-group&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;%=&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; label f, &lt;span class=&quot;hljs-symbol&quot;&gt;:email&lt;/span&gt;, &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt;: &quot;&lt;span class=&quot;hljs-title&quot;&gt;control&lt;/span&gt;-&lt;span class=&quot;hljs-title&quot;&gt;label&lt;/span&gt;&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;%&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;%=&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; text_input f, &lt;span class=&quot;hljs-symbol&quot;&gt;:email&lt;/span&gt;, &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt;: &quot;&lt;span class=&quot;hljs-title&quot;&gt;form&lt;/span&gt;-&lt;span class=&quot;hljs-title&quot;&gt;control&lt;/span&gt;&quot;, &lt;span class=&quot;hljs-title&quot;&gt;autofocus&lt;/span&gt;: &lt;span class=&quot;hljs-title&quot;&gt;true&lt;/span&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;%&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;%=&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; error_tag f, &lt;span class=&quot;hljs-symbol&quot;&gt;:email&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;hljs-attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;hljs-string&quot;&gt;&quot;form-group&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;%=&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; submit &lt;span class=&quot;hljs-string&quot;&gt;&quot;Request login link&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt;: &quot;&lt;span class=&quot;hljs-title&quot;&gt;btn&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;btn&lt;/span&gt;-&lt;span class=&quot;hljs-title&quot;&gt;primary&lt;/span&gt;&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;/&lt;span class=&quot;hljs-name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;%&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Signing Up&lt;/h2&gt;
&lt;p&gt;Before we get to the &lt;code&gt;TokenAuthentication&lt;/code&gt; service we shall not forget about the sign up process.
A nice side effect of using passwordless authentication by providing the login link via email is that we will always have a verified email address.
You can utilize this to attach email verification to the login process for instance.&lt;/p&gt;
&lt;p&gt;When the user signs up we should provide the first login token along with the welcome email.
To do so we will use the &lt;code&gt;TokenAuthentication.provide_token&lt;/code&gt; function that we also used before in the &lt;code&gt;create&lt;/code&gt; action of the &lt;code&gt;SessionController&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;alias&lt;/span&gt; MyApp.{TokenAuthentication, User}

&lt;span class=&quot;hljs-variable&quot;&gt;@doc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
  Sign up action, most likely UserController.create/2
&quot;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;create&lt;/span&gt;&lt;/span&gt;(conn, %{&lt;span class=&quot;hljs-string&quot;&gt;&quot;user&quot;&lt;/span&gt; =&amp;gt; user_params}) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
  changeset = User.changeset(%User{}, user_params)

  &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; Repo.insert(changeset) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    {&lt;span class=&quot;hljs-symbol&quot;&gt;:ok&lt;/span&gt;, user} -&amp;gt;
      TokenAuthentication.provide_token(user)

      conn
      |&amp;gt; put_flash(&lt;span class=&quot;hljs-symbol&quot;&gt;:info&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;You signed up successfully. Please check your email.&quot;&lt;/span&gt;)
      |&amp;gt; redirect(&lt;span class=&quot;hljs-symbol&quot;&gt;to:&lt;/span&gt; page_path(conn, &lt;span class=&quot;hljs-symbol&quot;&gt;:index&lt;/span&gt;))

    {&lt;span class=&quot;hljs-symbol&quot;&gt;:error&lt;/span&gt;, changeset} -&amp;gt;
      render(conn, &lt;span class=&quot;hljs-string&quot;&gt;&quot;new.html&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;changeset:&lt;/span&gt; changeset)
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Putting it all together in the TokenAuthentication module&lt;/h2&gt;
&lt;p&gt;Now that we have already used the &lt;code&gt;TokenAuthentication&lt;/code&gt; service extensively, let’s look at its implementation in detail.
I stored the module in &lt;code&gt;web/services&lt;/code&gt; which you need to create as it is a custom folder for stuff like this.
It uses a mailer and &lt;code&gt;AuthenticationEmail&lt;/code&gt; module which we will get to afterwards.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyApp.TokenAuthentication&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;hljs-variable&quot;&gt;@moduledoc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Service with functions for creating and signing in with magic link tokens.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; Ecto.Query, &lt;span class=&quot;hljs-symbol&quot;&gt;only:&lt;/span&gt; [&lt;span class=&quot;hljs-symbol&quot;&gt;where:&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]

  &lt;span class=&quot;hljs-keyword&quot;&gt;alias&lt;/span&gt; MyApp.{AuthToken, Endpoint, Mailer, Repo, AuthenticationEmail, User}
  &lt;span class=&quot;hljs-keyword&quot;&gt;alias&lt;/span&gt; Phoenix.Token

  &lt;span class=&quot;hljs-comment&quot;&gt;# token is valid for 30 minutes / 1800 seconds&lt;/span&gt;
  &lt;span class=&quot;hljs-variable&quot;&gt;@token_max_age&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1_800&lt;/span&gt;

  &lt;span class=&quot;hljs-variable&quot;&gt;@doc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Creates and sends a new magic login token to the user or email.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;provide_token&lt;/span&gt;&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;nil&lt;/span&gt;), &lt;span class=&quot;hljs-symbol&quot;&gt;do:&lt;/span&gt; {&lt;span class=&quot;hljs-symbol&quot;&gt;:error&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;:not_found&lt;/span&gt;}

  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;provide_token&lt;/span&gt;&lt;/span&gt;(email) &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; is_binary(email) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    User
    |&amp;gt; Repo.get_by(&lt;span class=&quot;hljs-symbol&quot;&gt;email:&lt;/span&gt; email)
    |&amp;gt; send_token()
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;provide_token&lt;/span&gt;&lt;/span&gt;(user = %User{}) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    send_token(user)
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-variable&quot;&gt;@doc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Checks the given token.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;verify_token_value&lt;/span&gt;&lt;/span&gt;(value) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    AuthToken
    |&amp;gt; where([t], t.value == ^value)
    |&amp;gt; where([t], t.inserted_at &amp;gt; datetime_add(^Ecto.DateTime.utc, ^(&lt;span class=&quot;hljs-variable&quot;&gt;@token_max_age&lt;/span&gt; * &lt;span class=&quot;hljs-number&quot;&gt;-1&lt;/span&gt;), &lt;span class=&quot;hljs-string&quot;&gt;&quot;second&quot;&lt;/span&gt;))
    |&amp;gt; Repo.one()
    |&amp;gt; verify_token()
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-comment&quot;&gt;# Unexpired token could not be found.&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defp&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;verify_token&lt;/span&gt;&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;nil&lt;/span&gt;), &lt;span class=&quot;hljs-symbol&quot;&gt;do:&lt;/span&gt; {&lt;span class=&quot;hljs-symbol&quot;&gt;:error&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;:invalid&lt;/span&gt;}

  &lt;span class=&quot;hljs-comment&quot;&gt;# Loads the user and deletes the token as it is now used once.&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defp&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;verify_token&lt;/span&gt;&lt;/span&gt;(token) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    token =
      token
      |&amp;gt; Repo.preload(&lt;span class=&quot;hljs-symbol&quot;&gt;:user&lt;/span&gt;)
      |&amp;gt; Repo.delete!

    user_id = token.user.id

    &lt;span class=&quot;hljs-comment&quot;&gt;# verify the token matching the user id&lt;/span&gt;
    &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; Token.verify(Endpoint, &lt;span class=&quot;hljs-string&quot;&gt;&quot;user&quot;&lt;/span&gt;, token.value, &lt;span class=&quot;hljs-symbol&quot;&gt;max_age:&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@token_max_age&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
      {&lt;span class=&quot;hljs-symbol&quot;&gt;:ok&lt;/span&gt;, ^user_id} -&amp;gt;
        {&lt;span class=&quot;hljs-symbol&quot;&gt;:ok&lt;/span&gt;, token.user}

      &lt;span class=&quot;hljs-comment&quot;&gt;# reason can be :invalid or :expired&lt;/span&gt;
      {&lt;span class=&quot;hljs-symbol&quot;&gt;:error&lt;/span&gt;, reason} -&amp;gt;
        {&lt;span class=&quot;hljs-symbol&quot;&gt;:error&lt;/span&gt;, reason}
    &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-comment&quot;&gt;# User could not be found by email.&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defp&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;send_token&lt;/span&gt;&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;nil&lt;/span&gt;), &lt;span class=&quot;hljs-symbol&quot;&gt;do:&lt;/span&gt; {&lt;span class=&quot;hljs-symbol&quot;&gt;:error&lt;/span&gt;, &lt;span class=&quot;hljs-symbol&quot;&gt;:not_found&lt;/span&gt;}

  &lt;span class=&quot;hljs-comment&quot;&gt;# Creates a token and sends it to the user.&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defp&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;send_token&lt;/span&gt;&lt;/span&gt;(user) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    user
    |&amp;gt; create_token()
    |&amp;gt; AuthenticationEmail.login_link(user)
    |&amp;gt; Mailer.deliver_now()

    {&lt;span class=&quot;hljs-symbol&quot;&gt;:ok&lt;/span&gt;, user}
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;hljs-comment&quot;&gt;# Creates a new token for the given user and returns the token value.&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defp&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;create_token&lt;/span&gt;&lt;/span&gt;(user) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    changeset = AuthToken.changeset(%AuthToken{}, user)
    auth_token = Repo.insert!(changeset)
    auth_token.value
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;note&quot;&gt;
**Sidenote:** Almost all of the functions cover edge cases by pattern matching on the arguments.
You will see this pattern oftentimes in Elixir and it makes code much more readable:
Instead of conditionally branching inside a single function you get a separate functions for every case.
I just love this feature! 💜
&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;verify_token_value&lt;/code&gt; function ensures that the token has not expired.
It does so by limiting the fetch from the database and setting a &lt;code&gt;where&lt;/code&gt; clause for the time period.
You could also handle this by fetching the token without the clause and just using the &lt;code&gt;Phoenix.Token.verify/4&lt;/code&gt; function providing the &lt;code&gt;max_age&lt;/code&gt; option.
This would give you the chance to have different error messages for cases of invalid and expired tokens.
(I will leave that as an exercise for you – the &lt;code&gt;:invalid&lt;/code&gt; and &lt;code&gt;:expired&lt;/code&gt; cases should get handled in &lt;code&gt;SessionController.show/2&lt;/code&gt; then)&lt;/p&gt;
&lt;p&gt;Once the token is used the &lt;code&gt;verify_token&lt;/code&gt; function deletes the token.
This way tokens cannot be redeemed multiple times.
This also implies that we might also want a task for cleaning up the database as unused tokens accumulate.
We will save this task for a separate post though – let’s get to the mailer …&lt;/p&gt;
&lt;h2&gt;Sending the emails&lt;/h2&gt;
&lt;p&gt;We will use the Bamboo library for creating and sending email in our app.
The &lt;a href=&quot;http://www.phoenixframework.org/docs/sending-email&quot;&gt;official guide for sending email&lt;/a&gt; uses it too and the
&lt;a href=&quot;https://hexdocs.pm/bamboo/readme.html&quot;&gt;Bamboo documentation&lt;/a&gt; is great.
It covers a wide range of topics as the library also has proper testing support and Phoenix integration.&lt;/p&gt;
&lt;p&gt;I assume you have the Bamboo basics set up and we can focus on the interesting parts.
The &lt;code&gt;Mailer&lt;/code&gt; module is just for actually sending the emails.
It just contains some wiring and is stored in &lt;code&gt;lib/my_app/mailer.ex&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyApp.Mailer&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;hljs-variable&quot;&gt;@moduledoc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    Base mailer. Adds Bamboo mailer for sending mails.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-keyword&quot;&gt;use&lt;/span&gt; Bamboo.Mailer, &lt;span class=&quot;hljs-symbol&quot;&gt;otp_app:&lt;/span&gt; &lt;span class=&quot;hljs-symbol&quot;&gt;:my_app&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &lt;code&gt;AuthenticationEmail&lt;/code&gt; module contains the function that prepares the email.
It gets stored in &lt;code&gt;web/emails/authentication_email.ex&lt;/code&gt; and this is what it looks like:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyApp.AuthenticationEmail&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;hljs-keyword&quot;&gt;use&lt;/span&gt; Bamboo.Phoenix, &lt;span class=&quot;hljs-symbol&quot;&gt;view:&lt;/span&gt; MyApp.EmailView

  &lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; Bamboo.Email

  &lt;span class=&quot;hljs-variable&quot;&gt;@doc&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&quot;&quot;
    The sign in email containing the login link.
  &quot;&quot;&quot;&lt;/span&gt;
  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;login_link&lt;/span&gt;&lt;/span&gt;(token_value, user) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt;
    new_email()
    |&amp;gt; to(user.email)
    |&amp;gt; from(&lt;span class=&quot;hljs-string&quot;&gt;&quot;info@myapp.com&quot;&lt;/span&gt;)
    |&amp;gt; subject(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Your login link&quot;&lt;/span&gt;)
    |&amp;gt; assign(&lt;span class=&quot;hljs-symbol&quot;&gt;:token&lt;/span&gt;, token_value)
    |&amp;gt; render(&lt;span class=&quot;hljs-string&quot;&gt;&quot;login_link.text&quot;&lt;/span&gt;)
  &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To keep it short let’s focus on what is absolutely necessarry in the login email.
From an UX perspective this could use some more love, but you will get the idea:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-erb&quot;&gt;&lt;span class=&quot;xml&quot;&gt;Here is your login link:

&lt;span class=&quot;hljs-tag&quot;&gt;&amp;lt;&lt;span class=&quot;hljs-name&quot;&gt;%=&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;ruby&quot;&gt; signin_url(MyApp.Endpoint, &lt;span class=&quot;hljs-symbol&quot;&gt;:show&lt;/span&gt;, @token) &lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;%&amp;gt;&lt;/span&gt;

It is valid for 30 minutes.
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;Well, that is about it.
You learned the basics of implementing a secure and user-friendly way to authenticate users in your Phoenix app 😀&lt;/p&gt;
&lt;p&gt;As this article is already very long I did not include any tests – I might cover this in a separate article some time soon.
We also did not cover edge cases like the user losing access to the email address and recovering from that.
Things like that can get pretty app-specific, nevertheless I hope this guide gives you a basic understanding of how to approach passwordless authentication in Phoenix.&lt;/p&gt;
&lt;p&gt;The implementation might also serve as a foundation to add more authentication methods.
By encapsulating the authentication logic into a separate services instead of having it in the controller we can swap it out with a little bit of refactoring.&lt;/p&gt;
&lt;h2&gt;Updates&lt;/h2&gt;
&lt;p&gt;The article got updated thanks to the feedback from &lt;a href=&quot;https://www.reddit.com/r/elixir/comments/5myy00/comment/dc8gegw&quot;&gt;reddit user q1t&lt;/a&gt;
and &lt;a href=&quot;https://elixirforum.com/t/passwordless-authentication-in-phoenix/3212/2&quot;&gt;bobbypriambodo in the Elixir Forum&lt;/a&gt;.
It now incorporates &lt;code&gt;Phoenix.Token&lt;/code&gt; to sign and verify the token value.
Also we avoid leaking security information about users that exist in the app.
Thanks very miuch for the nice feedback!&lt;/p&gt;
</p></main><footer><h2>Kontakt</h2><a class="button" href="#">Napiš mi</a></footer></body>