<!DOCTYPE html><head><title>Viktor Břenek</title><meta content="text/html;charset=utf-8" http-equiv="Content-Type"><meta content="utf-8" http-equiv="encoding"><meta name="author" content="Petr Břenek"><meta name="description" content="Osobní blog a portfolio"><meta property="og:image" content="http://viktorbrenek.github.io/assets/images/modely.png"><meta name="viewport" content="width=device-width,initial-scale=1.0"><link rel="stylesheet" href="../styles.css"><meta charset="utf-8"><title>Blog</title></head><body><ul class="links" id="links"> <li><a class="who" href="https://discord.com/invite/2Uj6N5N" target="_blank">Discord</a></li><li><a class="blog" href="https://www.youtube.com/c/ViktorBřenekYT" target="_blank">Youtube</a></li><li><a class="source" href="https://github.com/viktorbrenek" target="_blank">Github</a></li></ul><menu><a class="name" href="#">Viktor Břenek</a><a class="name" href="../blog.html">Blog</a><a class="name" href="../index.html">Portfolio</a></menu><main class="gridblog"><h1 class="atitle">Delegating HTML links to vue-router</h1><div><span><ul class="task__tags"><li class="task__tag task__tag--copyright">Vue.js</li><li class="task__tag task__tag--copyright">Vue</li><li class="task__tag task__tag--copyright">vue-router</li><li class="task__tag task__tag--copyright">Frontend development</li></ul></span></div><p>When you are dealing with dynamic or user generated content in a Vue.js application, you might want <a href="https://router.vuejs.org/">vue-router</a> to handle internal HTML links.
Links that are not implemented via <code>&lt;router-link&gt;</code> will trigger a full page reload. So we need a way to hijack clicks on <code>&lt;a href&gt;</code> and delegate them to vue-router in case they reference an internal resource.
There are two ways to intercept the clicks, depending on your use case and needs.</p>
<h2>Application-wide handling</h2>
<p>In case you have dynamic links all over your application you can intercept them globally.
To do this, bind the event listener to the window in your top-most/main app components <code>mounted</code> lifecycle hook:</p>
<pre><code class="language-javascript">mounted () {
  <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'click'</span>, event =&gt; {
    <span class="hljs-comment">// ensure we use the link, in case the click has been received by a subelement</span>
    <span class="hljs-keyword">let</span> { target } = event
    <span class="hljs-keyword">while</span> (target &amp;&amp; target.tagName !== <span class="hljs-string">'A'</span>) target = target.parentNode
    <span class="hljs-comment">// handle only links that do not reference external resources</span>
    <span class="hljs-keyword">if</span> (target &amp;&amp; target.matches(<span class="hljs-string">"a:not([href*='://'])"</span>) &amp;&amp; target.href) {
      <span class="hljs-comment">// some sanity checks taken from vue-router:</span>
      <span class="hljs-comment">// https://github.com/vuejs/vue-router/blob/dev/src/components/link.js#L106</span>
      <span class="hljs-keyword">const</span> { altKey, ctrlKey, metaKey, shiftKey, button, defaultPrevented } = event
      <span class="hljs-comment">// don't handle with control keys</span>
      <span class="hljs-keyword">if</span> (metaKey || altKey || ctrlKey || shiftKey) <span class="hljs-keyword">return</span>
      <span class="hljs-comment">// don't handle when preventDefault called</span>
      <span class="hljs-keyword">if</span> (defaultPrevented) <span class="hljs-keyword">return</span>
      <span class="hljs-comment">// don't handle right clicks</span>
      <span class="hljs-keyword">if</span> (button !== <span class="hljs-literal">undefined</span> &amp;&amp; button !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-comment">// don't handle if `target="_blank"`</span>
      <span class="hljs-keyword">if</span> (target &amp;&amp; target.getAttribute) {
        <span class="hljs-keyword">const</span> linkTarget = target.getAttribute(<span class="hljs-string">'target'</span>)
        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\b_blank\b/i</span>.test(linkTarget)) <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// don't handle same page links/anchors</span>
      <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> URL(target.href)
      <span class="hljs-keyword">const</span> to = url.pathname
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.location.pathname !== to &amp;&amp; event.preventDefault) {
        event.preventDefault()
        <span class="hljs-keyword">this</span>.$router.push(to)
      }
    }
  })
}
</code></pre>
<h2>Encapsulation in a component</h2>
<p>If there are only certain places where this kind of link handling must occur, you should encapsulate the event handling in a component.
The advantage of this is, that it will be more performant and there is no need to interfere with the rest of the apps links.</p>
<p>The components template might look like this:</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"dynamic-content"</span>
  @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClicks"</span>
  <span class="hljs-attr">v-html</span>=<span class="hljs-string">"dynamicContent"</span>
/&gt;</span>
</code></pre>
<p>Here <code>dynamicContent</code> is a html string containing the <code>&lt;a href&gt;</code> links, which the <code>handleClicks</code> method takes care of:</p>
<pre><code class="language-javascript">methods: {
  handleClicks (event) {
    <span class="hljs-comment">// ensure we use the link, in case the click has been received by a subelement</span>
    <span class="hljs-keyword">let</span> { target } = event
    <span class="hljs-keyword">while</span> (target &amp;&amp; target.tagName !== <span class="hljs-string">'A'</span>) target = target.parentNode
    <span class="hljs-comment">// handle only links that occur inside the component and do not reference external resources</span>
    <span class="hljs-keyword">if</span> (target &amp;&amp; target.matches(<span class="hljs-string">".dynamic-content a:not([href*='://'])"</span>) &amp;&amp; target.href) {
      <span class="hljs-comment">// some sanity checks taken from vue-router:</span>
      <span class="hljs-comment">// https://github.com/vuejs/vue-router/blob/dev/src/components/link.js#L106</span>
      <span class="hljs-keyword">const</span> { altKey, ctrlKey, metaKey, shiftKey, button, defaultPrevented } = event
      <span class="hljs-comment">// don't handle with control keys</span>
      <span class="hljs-keyword">if</span> (metaKey || altKey || ctrlKey || shiftKey) <span class="hljs-keyword">return</span>
      <span class="hljs-comment">// don't handle when preventDefault called</span>
      <span class="hljs-keyword">if</span> (defaultPrevented) <span class="hljs-keyword">return</span>
      <span class="hljs-comment">// don't handle right clicks</span>
      <span class="hljs-keyword">if</span> (button !== <span class="hljs-literal">undefined</span> &amp;&amp; button !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-comment">// don't handle if `target="_blank"`</span>
      <span class="hljs-keyword">if</span> (target &amp;&amp; target.getAttribute) {
        <span class="hljs-keyword">const</span> linkTarget = target.getAttribute(<span class="hljs-string">'target'</span>)
        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\b_blank\b/i</span>.test(linkTarget)) <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// don't handle same page links/anchors</span>
      <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> URL(target.href)
      <span class="hljs-keyword">const</span> to = url.pathname
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.location.pathname !== to &amp;&amp; event.preventDefault) {
        event.preventDefault()
        <span class="hljs-keyword">this</span>.$router.push(to)
      }
    }
  }
}
</code></pre>
<p>As you can see, this hijacks only a subset of the link clicks – those that occur inside of this component.</p>
</main><footer></footer></body>